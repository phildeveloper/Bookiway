@page "/"
@page "/translation"
@layout EmptyLayout
@rendermode InteractiveServer

@using System.Globalization
@using System.IO
@using System.Linq
@using BookiwayApp.Services

@inject PdfDecomposerService PdfDecomposer
@inject IJSRuntime JS
@inject GeminiTranslationService Translator

<PageTitle>Translation</PageTitle>

<div class="translation-shell">
    <header class="hero">
        <span class="hero-brand">Bookiway</span>
    </header>

    <section class="step-card">
        <div class="step-heading">
            <span class="step-number">01</span>
            <div>
                <h2>–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–∞</h2>
                <p>–ú—ã –∑–∞–ø–æ–º–∏–Ω–∞–µ–º –∫–∞–∂–¥—ã–π –≤—ã–±–æ—Ä, –ø–æ—ç—Ç–æ–º—É –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –≤—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ —Å —Ç–æ–≥–æ –∂–µ –º–µ—Å—Ç–∞.</p>
            </div>
        </div>

        <div class="step-block">
            <p class="step-label">PDF-—Ñ–∞–π–ª</p>
            <label class="file-picker" for="pdfUpload">
                <span class="file-picker-icon" aria-hidden="true">üìÑ</span>
                <span class="file-picker-text">@(_fileName is null ? "–í—ã–±—Ä–∞—Ç—å PDF" : _fileName)</span>
                <InputFile id="pdfUpload" OnChange="HandleFileSelected" accept="application/pdf" />
            </label>
            <p class="muted-text">–§–∞–π–ª –¥–æ 10 –ú–ë. –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—ã–±–æ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ cookies.</p>
            @if (!string.IsNullOrWhiteSpace(_lastPdfName) && _selectedFile is null)
            {
                <p class="muted-link" aria-live="polite">–ü–æ—Å–ª–µ–¥–Ω–∏–π —Ñ–∞–π–ª: @_lastPdfName</p>
            }
        </div>

        <div class="step-block">
            <p class="step-label">–ü–∞–ø–∫–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</p>
            <div class="input-row">
                <span class="input-chip">@(!string.IsNullOrWhiteSpace(TrimmedOutputDirectory) ? TrimmedOutputDirectory : "–ù–µ –≤—ã–±—Ä–∞–Ω–∞")</span>
                <button type="button" class="ghost-button" @onclick="() => OpenDirectoryPicker(DirectoryTarget.Images)" disabled="@_isProcessing">–í—ã–±—Ä–∞—Ç—å</button>
            </div>
            <p class="muted-text">–ü—É—Ç—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ –∏ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ cookies.</p>
        </div>

        <div class="step-block">
            <p class="step-label">–†–∞–∑–ª–æ–∂–∏—Ç—å PDF –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</p>
            <button class="primary-button" @onclick="StartDecompositionAsync" disabled="@IsDecomposeDisabled">
                @if (_isProcessing)
                {
                    <span class="spinner" aria-hidden="true"></span>
                }
                <span>@(_isProcessing ? "–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º..." : "–†–∞–∑–ª–æ–∂–∏—Ç—å")</span>
            </button>

            @if (_isProcessing)
            {
                <div class="progress" role="status" aria-live="polite">
                    <div class="progress-bar" style="width: @_progressPercent%;"></div>
                </div>
                <p class="progress-value">@_progressPercent%</p>
            }

            @if (!string.IsNullOrEmpty(_statusMessage))
            {
                var statusClass = _isSuccess ? "status success" : "status error";
                <p class="@statusClass">@_statusMessage</p>
            }
        </div>
    </section>

    <section class="step-card">
        <div class="step-heading">
            <span class="step-number">02</span>
            <div>
                <h2>–ü–µ—Ä–µ–≤–æ–¥ –¥–∏–∞–ø–∞–∑–æ–Ω–∞</h2>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–∞–ø–∫—É –¥–ª—è HTML, –¥–∞–ª—å—à–µ –≤—Å—ë —Å–¥–µ–ª–∞–µ—Ç Gemini.</p>
            </div>
        </div>

        <div class="step-block">
            <p class="step-label">–î–∏–∞–ø–∞–∑–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü</p>
            <div class="range-row">
                <input type="number" min="1" max="@_totalPages" value="@_pageFrom" @oninput="OnPageFromChangedAsync" class="range-input" />
                <span class="range-separator">‚Äî</span>
                <input type="number" min="1" max="@_totalPages" value="@_pageTo" @oninput="OnPageToChangedAsync" class="range-input" />
                <span class="range-total">@(_totalPages > 0 ? $"–í—Å–µ–≥–æ: {_totalPages}" : "–ü–æ–∫–∞ –Ω–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü")</span>
            </div>
            @if (!string.IsNullOrEmpty(_pageRangeError))
            {
                <p class="status error">@_pageRangeError</p>
            }
        </div>

        <div class="step-block">
            <p class="step-label">–ü–∞–ø–∫–∞ –¥–ª—è HTML</p>
            <div class="input-row">
                <span class="input-chip">@(!string.IsNullOrWhiteSpace(TrimmedTranslationDirectory) ? TrimmedTranslationDirectory : "–ù–µ –≤—ã–±—Ä–∞–Ω–∞")</span>
                <button type="button" class="ghost-button" @onclick="() => OpenDirectoryPicker(DirectoryTarget.Html)" disabled="@_isTranslating">–í—ã–±—Ä–∞—Ç—å</button>
            </div>
            <p class="muted-text">–°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Ç—å –≤ cookies, —á—Ç–æ–±—ã –Ω–µ –≤–≤–æ–¥–∏—Ç—å –µ–≥–æ –∑–∞–Ω–æ–≤–æ.</p>
        </div>

        <div class="step-block">
            <p class="step-label">–ó–∞–ø—É—Å–∫ –ø–µ—Ä–µ–≤–æ–¥–∞</p>
            <button class="primary-button" @onclick="StartTranslationAsync" disabled="@(!_isPageRangeValid || _totalPages == 0 || string.IsNullOrWhiteSpace(TrimmedTranslationDirectory) || _isTranslating)">
                @if (_isTranslating)
                {
                    <span class="spinner" aria-hidden="true"></span>
                }
                <span>@(_isTranslating ? "–ü–µ—Ä–µ–≤–æ–¥–∏–º..." : "–ü–µ—Ä–µ–≤–µ—Å—Ç–∏ —Å –ø–æ–º–æ—â—å—é Gemini")</span>
            </button>

            @if (_isTranslating)
            {
                <div class="progress" role="status" aria-live="polite">
                    <div class="progress-bar" style="width: @_translateProgress%;"></div>
                </div>
                <p class="progress-value">@_translateProgress%</p>
            }

            @if (!string.IsNullOrEmpty(_translateStatus))
            {
                var tClass = _translateSuccess ? "status success" : "status error";
                <p class="@tClass">@_translateStatus</p>
            }
        </div>
    </section>

    @if (_isDirectoryPickerOpen)
    {
        <div class="directory-modal" role="dialog" aria-modal="true">
            <div class="directory-modal-content">
                <div class="directory-modal-header">
                    <h3>–í—ã–±–æ—Ä –ø–∞–ø–∫–∏</h3>
                    <p class="directory-modal-path" title="@_directoryBrowserPath">@_directoryBrowserPath</p>
                </div>

                @if (!string.IsNullOrEmpty(_directoryBrowserError))
                {
                    <p class="status error">@_directoryBrowserError</p>
                }

                <div class="directory-browser">
                    <div class="directory-browser-actions">
                        <button type="button" class="ghost-button" @onclick="NavigateUp" disabled="@(!CanNavigateUp)">–í–≤–µ—Ä—Ö</button>
                        <button type="button" class="ghost-button" @onclick="RefreshCurrentDirectory">–û–±–Ω–æ–≤–∏—Ç—å</button>
                    </div>

                    <ul class="directory-list" role="listbox">
                        @if (_directoryEntries.Count == 0)
                        {
                            <li class="directory-empty">–í–Ω—É—Ç—Ä–∏ –Ω–µ—Ç –ø–∞–ø–æ–∫</li>
                        }
                        else
                        {
                            @foreach (var entry in _directoryEntries)
                            {
                                <li>
                                    <button type="button" class="directory-item" @onclick="() => NavigateToDirectory(entry.FullPath)">
                                        <span class="directory-item-icon" aria-hidden="true"></span>
                                        <span>@entry.Name</span>
                                    </button>
                                </li>
                            }
                        }
                    </ul>
                </div>

                <div class="directory-modal-footer">
                    <button type="button" class="primary-button" @onclick="ConfirmDirectorySelectionAsync">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞–ø–∫—É</button>
                    <button type="button" class="ghost-button" @onclick="CloseDirectoryPicker">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
        </div>
    }
</div>

@code {
    private const long MaxFileSize = 10 * 1024 * 1024;
    private const string PdfNameCookie = "bw_last_pdf_name";
    private const string ImagesDirCookie = "bw_last_output_dir";
    private const string HtmlDirCookie = "bw_last_html_dir";
    private const string PageFromCookie = "bw_last_page_from";
    private const string PageToCookie = "bw_last_page_to";

    private IBrowserFile? _selectedFile;
    private string? _fileName;
    private string _outputDirectory = string.Empty;
    private string _translationOutputDirectory = string.Empty;
    private string? _lastPdfName;
    private int _totalPages;
    private int _pageFrom = 1;
    private int _pageTo = 1;
    private bool _isPageRangeValid = true;
    private string? _pageRangeError;
    private bool _isProcessing;
    private bool _isTranslating;
    private int _translateProgress;
    private string? _translateStatus;
    private bool _translateSuccess;
    private int _progressPercent;
    private string? _statusMessage;
    private bool _isSuccess;
    private bool _isDirectoryPickerOpen;
    private string _directoryBrowserPath = string.Empty;
    private List<DirectoryEntry> _directoryEntries = new();
    private string? _directoryBrowserError;
    private DirectoryTarget _directoryTarget = DirectoryTarget.Images;

    private bool IsDecomposeDisabled => _selectedFile is null || string.IsNullOrWhiteSpace(TrimmedOutputDirectory) || _isProcessing;
    private bool CanNavigateUp => TryGetParentDirectory(_directoryBrowserPath) is not null;
    private string TrimmedOutputDirectory => _outputDirectory?.Trim() ?? string.Empty;
    private string TrimmedTranslationDirectory => _translationOutputDirectory?.Trim() ?? string.Empty;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender)
        {
            return;
        }

        _lastPdfName = await GetCookieAsync(PdfNameCookie);
        var savedImagesDir = await GetCookieAsync(ImagesDirCookie);
        if (!string.IsNullOrWhiteSpace(savedImagesDir))
        {
            _outputDirectory = savedImagesDir!;
        }

        var savedHtmlDir = await GetCookieAsync(HtmlDirCookie);
        if (!string.IsNullOrWhiteSpace(savedHtmlDir))
        {
            _translationOutputDirectory = savedHtmlDir!;
        }

        var savedFrom = await GetCookieAsync(PageFromCookie);
        if (int.TryParse(savedFrom, NumberStyles.Integer, CultureInfo.InvariantCulture, out var fromValue) && fromValue > 0)
        {
            _pageFrom = fromValue;
        }

        var savedTo = await GetCookieAsync(PageToCookie);
        if (int.TryParse(savedTo, NumberStyles.Integer, CultureInfo.InvariantCulture, out var toValue) && toValue > 0)
        {
            _pageTo = toValue;
        }

        if (!string.IsNullOrWhiteSpace(TrimmedOutputDirectory))
        {
            await RecalculatePagesFromImagesFolderAsync();
        }
        else
        {
            ValidatePageRange();
            await PersistPageRangeAsync();
        }

        StateHasChanged();
    }

    private async Task HandleFileSelected(InputFileChangeEventArgs e)
    {
        _selectedFile = e.File;
        _fileName = e.File?.Name;
        _statusMessage = null;

        if (!string.IsNullOrWhiteSpace(_fileName))
        {
            await SaveCookieAsync(PdfNameCookie, _fileName);
            _lastPdfName = _fileName;
        }
    }

    private enum DirectoryTarget { Images, Html }

    private void OpenDirectoryPicker(DirectoryTarget target)
    {
        _directoryTarget = target;
        var current = target == DirectoryTarget.Images ? TrimmedOutputDirectory : TrimmedTranslationDirectory;
        var initialPath = string.IsNullOrWhiteSpace(current) ? GetDefaultDirectory() : current;

        _directoryBrowserError = null;

        if (!TryLoadDirectory(initialPath))
        {
            TryLoadDirectory(GetDefaultDirectory());
        }

        _isDirectoryPickerOpen = true;
    }

    private void CloseDirectoryPicker()
    {
        _isDirectoryPickerOpen = false;
    }

    private async Task ConfirmDirectorySelectionAsync()
    {
        if (!string.IsNullOrWhiteSpace(_directoryBrowserPath))
        {
            if (_directoryTarget == DirectoryTarget.Images)
            {
                _outputDirectory = _directoryBrowserPath;
                await SaveCookieAsync(ImagesDirCookie, _outputDirectory);
                await RecalculatePagesFromImagesFolderAsync();
            }
            else
            {
                _translationOutputDirectory = _directoryBrowserPath;
                await SaveCookieAsync(HtmlDirCookie, _translationOutputDirectory);
            }
        }

        _isDirectoryPickerOpen = false;
    }

    private void NavigateToDirectory(string path)
    {
        TryLoadDirectory(path);
    }

    private void NavigateUp()
    {
        var parent = TryGetParentDirectory(_directoryBrowserPath);
        if (parent is not null)
        {
            TryLoadDirectory(parent.FullName);
        }
    }

    private void RefreshCurrentDirectory()
    {
        TryLoadDirectory(_directoryBrowserPath);
    }

    private async Task StartDecompositionAsync()
    {
        if (_selectedFile is null)
        {
            _statusMessage = "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ PDF-—Ñ–∞–π–ª.";
            _isSuccess = false;
            return;
        }

        if (string.IsNullOrWhiteSpace(TrimmedOutputDirectory))
        {
            _statusMessage = "–ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ø–∞–ø–∫—É –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.";
            _isSuccess = false;
            return;
        }

        _isProcessing = true;
        _statusMessage = null;
        _isSuccess = false;
        _progressPercent = 0;
        _totalPages = 0;

        var progress = new Progress<double>(value =>
        {
            _progressPercent = (int)Math.Clamp(Math.Round(value * 100, MidpointRounding.AwayFromZero), 0, 100);
            InvokeAsync(StateHasChanged);
        });

        try
        {
            await using var stream = _selectedFile.OpenReadStream(MaxFileSize);
            var outputDirectory = TrimmedOutputDirectory;
            var result = await PdfDecomposer.DecomposeAsync(stream, outputDirectory, progress);

            _isSuccess = true;
            _statusMessage = result.PageCount == 0
                ? "PDF –Ω–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å."
                : $"–ì–æ—Ç–æ–≤–æ: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ {result.PageCount} —Å—Ç—Ä–∞–Ω–∏—Ü –≤ '{outputDirectory}'.";
            _progressPercent = 100;

            _totalPages = result.PageCount;
            _pageFrom = _totalPages > 0 ? 1 : 0;
            _pageTo = _totalPages;
            ValidatePageRange();
            await PersistPageRangeAsync();
        }
        catch (Exception ex)
        {
            _isSuccess = false;
            _statusMessage = $"–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–ª–æ–∂–∏—Ç—å PDF: {ex.Message}";
        }
        finally
        {
            _isProcessing = false;
            await InvokeAsync(StateHasChanged);
        }
    }

    private async Task OnPageFromChangedAsync(ChangeEventArgs e)
    {
        if (int.TryParse(Convert.ToString(e.Value, CultureInfo.InvariantCulture), NumberStyles.Integer, CultureInfo.InvariantCulture, out var value))
        {
            _pageFrom = value;
            ValidatePageRange();
            await PersistPageRangeAsync();
        }
    }

    private async Task OnPageToChangedAsync(ChangeEventArgs e)
    {
        if (int.TryParse(Convert.ToString(e.Value, CultureInfo.InvariantCulture), NumberStyles.Integer, CultureInfo.InvariantCulture, out var value))
        {
            _pageTo = value;
            ValidatePageRange();
            await PersistPageRangeAsync();
        }
    }

    private void ValidatePageRange()
    {
        _isPageRangeValid = _totalPages > 0 && _pageFrom >= 1 && _pageTo >= 1 && _pageFrom <= _pageTo && _pageTo <= _totalPages;
        _pageRangeError = _isPageRangeValid ? null : "–î–∏–∞–ø–∞–∑–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü –≤–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π.";
    }

    private async Task RecalculatePagesFromImagesFolderAsync()
    {
        try
        {
            if (!string.IsNullOrWhiteSpace(TrimmedOutputDirectory) && Directory.Exists(TrimmedOutputDirectory))
            {
                var files = Directory.GetFiles(TrimmedOutputDirectory, "page-*.png");
                _totalPages = files.Length;
                _pageFrom = _totalPages > 0 ? Math.Clamp(_pageFrom <= 0 ? 1 : _pageFrom, 1, _totalPages) : 0;
                _pageTo = _totalPages > 0 ? Math.Clamp(_pageTo <= 0 ? _totalPages : _pageTo, 1, _totalPages) : 0;
                ValidatePageRange();
            }
            else
            {
                _totalPages = 0;
                ValidatePageRange();
            }
        }
        catch
        {
            _totalPages = 0;
            ValidatePageRange();
        }

        await PersistPageRangeAsync();
        await InvokeAsync(StateHasChanged);
    }

    private async Task StartTranslationAsync()
    {
        if (!_isPageRangeValid || _totalPages == 0)
        {
            _translateSuccess = false;
            _translateStatus = "–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.";
            return;
        }

        var sourceDir = TrimmedOutputDirectory;
        var destinationDir = TrimmedTranslationDirectory;

        if (string.IsNullOrWhiteSpace(sourceDir) || string.IsNullOrWhiteSpace(destinationDir))
        {
            _translateSuccess = false;
            _translateStatus = "–ù—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –æ–±–µ –ø–∞–ø–∫–∏.";
            return;
        }

        _isTranslating = true;
        _translateProgress = 0;
        _translateStatus = null;
        _translateSuccess = false;

        var progress = new Progress<double>(value =>
        {
            _translateProgress = (int)Math.Clamp(Math.Round(value * 100, MidpointRounding.AwayFromZero), 0, 100);
            InvokeAsync(StateHasChanged);
        });

        try
        {
            var count = await Translator.TranslateRangeAsync(sourceDir, _pageFrom, _pageTo, destinationDir, progress);
            _translateSuccess = count > 0;
            _translateStatus = count == 0
                ? "–ù–µ –Ω–∞–π–¥–µ–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞."
                : $"–ì–æ—Ç–æ–≤–æ: —Å–æ–∑–¥–∞–Ω–æ {count} HTML-—Ñ–∞–π–ª–æ–≤ –≤ '{destinationDir}'.";
        }
        catch (Exception ex)
        {
            _translateSuccess = false;
            _translateStatus = $"–ù–µ —É–¥–∞–ª–æ—Å—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–µ—Ä–µ–≤–æ–¥: {ex.Message}";
        }
        finally
        {
            _isTranslating = false;
            await InvokeAsync(StateHasChanged);
        }
    }

    private bool TryLoadDirectory(string directory)
    {
        try
        {
            var fullPath = Path.GetFullPath(directory);
            if (!Directory.Exists(fullPath))
            {
                _directoryBrowserError = $"–ü–∞–ø–∫–∞ '{directory}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.";
                _directoryEntries = new List<DirectoryEntry>();
                return false;
            }

            _directoryBrowserPath = fullPath;
            _directoryEntries = Directory.GetDirectories(fullPath)
                .OrderBy(dir => dir, StringComparer.OrdinalIgnoreCase)
                .Select(dir => new DirectoryEntry(GetDirectoryDisplayName(dir), dir))
                .ToList();
            _directoryBrowserError = null;
            return true;
        }
        catch (Exception ex)
        {
            _directoryBrowserError = $"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å –ø–∞–ø–∫—É: {ex.Message}";
            _directoryEntries = new List<DirectoryEntry>();
            return false;
        }
    }

    private static string GetDirectoryDisplayName(string path)
    {
        var name = Path.GetFileName(path);
        if (string.IsNullOrEmpty(name))
        {
            name = new DirectoryInfo(path).Name;
        }

        return string.IsNullOrEmpty(name) ? path : name;
    }

    private static DirectoryInfo? TryGetParentDirectory(string? path)
    {
        if (string.IsNullOrWhiteSpace(path))
        {
            return null;
        }

        try
        {
            return Directory.GetParent(path);
        }
        catch
        {
            return null;
        }
    }

    private static string GetDefaultDirectory()
    {
        var candidates = new[]
        {
            Environment.GetFolderPath(Environment.SpecialFolder.MyDocuments),
            Environment.GetFolderPath(Environment.SpecialFolder.Desktop),
            Environment.GetFolderPath(Environment.SpecialFolder.UserProfile),
            Environment.CurrentDirectory
        };

        foreach (var candidate in candidates)
        {
            if (!string.IsNullOrWhiteSpace(candidate) && Directory.Exists(candidate))
            {
                return candidate;
            }
        }

        return Environment.CurrentDirectory;
    }

    private async Task SaveCookieAsync(string key, string value)
    {
        await JS.InvokeAsync<bool>("cookies.set", key, value, 365);
    }

    private async Task<string?> GetCookieAsync(string key)
    {
        return await JS.InvokeAsync<string?>("cookies.get", key);
    }

    private async Task PersistPageRangeAsync()
    {
        if (_pageFrom > 0)
        {
            await SaveCookieAsync(PageFromCookie, _pageFrom.ToString(CultureInfo.InvariantCulture));
        }

        if (_pageTo > 0)
        {
            await SaveCookieAsync(PageToCookie, _pageTo.ToString(CultureInfo.InvariantCulture));
        }
    }

    private sealed record DirectoryEntry(string Name, string FullPath);
}
